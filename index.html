<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div id='chatborder'>
        <p id="chatlog9" class="chatlog">&nbsp;</p>
        <p id="chatlog8" class="chatlog">&nbsp;</p>
        <p id="chatlog7" class="chatlog">&nbsp;</p>
        <p id="chatlog6" class="chatlog">&nbsp;</p>
        <p id="chatlog5" class="chatlog">&nbsp;</p>
        <p id="chatlog4" class="chatlog">&nbsp;</p>
        <p id="chatlog3" class="chatlog">&nbsp;</p>
        <p id="chatlog2" class="chatlog">&nbsp;</p>
        <p id="chatlog1" class="chatlog">&nbsp;</p>
        <input type="text" name="chat" id="chatbox" placeholder="Hi there! Type here to talk to me."
            onfocus="placeHolder()">
    </div>
</body>

</html>
<script>
    var messages = [], //array that hold the record of each string in chat
        lastUserMessage = "", //keeps track of the most recent input string from the user
        botMessage = "", //var keeps track of what the chatbot is going to say
        botName = 'Chattingbot', //name of the chatbot
        function chatbotResponse(message) {
            const formData = new FormData();
            fetch('/predict', {
                    method: "POST",
                    body: formData,
                }).then(async (response) => {
                    if (response.status == 200) {
                        return response;
                    } else if (response.status == 413) {
                        throw Error("This is 413 error");
                    } else {
                        throw Error((await response.clone().json()).message);
                    }
                })
                .then((response) => response.json())
                .then((data) => {
                    botMesasge = data.bot_msg;
                })
                .catch((e) => {
                    console.log(e);
                });
        }

    function newEntry() {

        if (document.getElementById("chatbox").value != "") {
            lastUserMessage = document.getElementById("chatbox").value;
            document.getElementById("chatbox").value = "";
            messages.push(lastUserMessage);
            chatbotResponse(lastUserMessage);
            messages.push("<b>" + botName + ":</b> " + botMessage);
            Speech(botMessage);
            for (var i = 1; i < 10; i++) {
                if (messages[messages.length - i])
                    document.getElementById("chatlog" + i).innerHTML = messages[messages.length - i];
            }
        }
    }

    function Speech(say) {
        if ('speechSynthesis' in window && talking) {
            var utterance = new SpeechSynthesisUtterance(say);
            speechSynthesis.speak(utterance);
        }
    }

    //runs the keypress() function when a key is pressed
    document.onkeypress = keyPress;
    //if the key pressed is 'enter' runs the function newEntry()
    function keyPress(e) {
        var x = e || window.event;
        var key = (x.keyCode || x.which);
        if (key == 13 || key == 3) {
            //runs this function when enter is pressed
            newEntry();
        }
        if (key == 38) {
            console.log('hi')
        }
    }

    //clears the placeholder text ion the chatbox
    //this function is set to run when the users brings focus to the chatbox, by clicking on it
    function placeHolder() {
        document.getElementById("chatbox").placeholder = "";
    }
</script>